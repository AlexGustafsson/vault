---
layout: docs
page_title: Vault Agent's Process Supervisor Mode
description: >-
  Vault Agent's Process Supervisor Mode allows Vault secrets to be injected
  into a process via environment variables using Consul Template markup.
---

# Vault Agent's Process Supervisor Mode

Vault Agent's Process Supervisor Mode allows Vault secrets to be injected into
a process via environment variables using
[Consul Template markup][consul-templating-language].

-> If you are running your applications in a Kubernetes cluster, we recommend
   evaluating the [Vault Secrets Operator](/vault/docs/platform/k8s/vso) instead.

!> Vault Agent's Process Supervisor Mode is in public beta. Please provide your
   feedback by opening a GitHub issue [here](https://github.com/hashicorp/vault/issues).

## Functionality

The `exec` stanza allows you to configure a child process for Vault Agent to run. Secrets are injected into the process
via environment variables configured from `env_template` blocks (see [Template Configurations](template-config) for more info).
When you start Vault Agent with `exec` enabled, it will wait until each environment variable template is rendered at
least once before starting the process.
Vault Agent will restart the process when an update to a injected secret is detected. The frequency secrets are
checked is controlled by the `static_secret_render_interval` configuration in the `template_config` stanza.

## Configuration

-> Agent's [generate-config](/vault/docs/agent-and-proxy/agent/generate-config)
   tool will help you get started by generating a valid agent configuration
   file from the given inputs.

Process Supervisor mode requires at least one `env_template` block and exactly
one top level `exec` block. It is incompatible with regular file `template`
entries.

### `env_template`

`env_template` maps a template specified in `contents` or referenced in `source`
to the environment variable name in the title of the stanza. It permits a subset
of the parameters supported by the
[file templates](/vault/docs/agent-and-proxy/agent/template#template_configurations):

- environment variable name `(string: <required>)` - the name of the
  environment variable to which the contents of the template should map.

- `contents` `(string: "")` - This option allows embedding the contents of
  a template in the configuration file rather then supplying the `source` path to
  the template file. This is useful for short templates. This option is mutually
  exclusive with the `source` option.

- `source` `(string: "")` - Path on disk to use as the input template. This
  option is required if not using the `contents` option.

- `error_on_missing_key` `(bool: false)` - Exit with an error when accessing
  a struct or map field/key that does notexist. The default behavior will print `<no value>`
  when accessing a field that does not exist. It is highly recommended you set this
  to "true". Also see [`exit_on_retry_failure` in global Vault Agent Template Config](/vault/docs/agent-and-proxy/agent/template#interaction-between-exit_on_retry_failure-and-error_on_missing_key).

- `left_delimiter` `(string: "{{")` - Delimiter to use in the template. The
  default is "{{" but for some templates, it may be easier to use a different
  delimiter that does not conflict with the output file itself.

- `right_delimiter` `(string: "}}")` - Delimiter to use in the template. The
  default is "}}" but for some templates, it may be easier to use a different
  delimiter that does not conflict with the output file itself.

### `exec`

The top level `exec` block has the following configuration entries.

- `command` `(string array: required)` - Specify the command for the child
  process with optional arguments. The executable's path must be either
  absolute or relative to the current working directory.

- `restart_on_secret_changes` `(string: "always")` - Only two accepted options:
  `always` and `never`. Controls a child process' behavior when a secret update is detected.

- `restart_stop_signal` `(string: "SIGTERM")` - Signal to send the child process when a secret has been updated and the
  process needs to be restarted. The process has a 30 seconds after this signal is sent until `SIGKILL` is sent to force
  the child process to stop.


[consul-templating-language]: https://github.com/hashicorp/consul-template/blob/v0.28.1/docs/templating-language.md
[template-config]: /vault/docs/agent-and-proxy/agent/template#template-configurations
