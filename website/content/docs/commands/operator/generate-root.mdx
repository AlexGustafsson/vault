---
layout: docs
page_title: operator generate-root - Command
description: |-
  The "operator generate-root" command generates a new root token by combining a
  quorum of share holders.
---

# operator generate-root

The `operator generate-root` command generates a new Vault root token by
combining a quorum of share holders. With the `-dr-token` or `-recovery-token`
options, it can generate a DR operation token or a recovery token in the same
way.

One of the following must be provided to start the root token generation:

- A base64-encoded one-time-password (OTP) provided via the `-otp` flag. Use the
  `-generate-otp` flag to generate a usable value. The resulting token is XORed
  with this value when it is returned. Use the `-decode` flag to output the
  final value.

- A file containing a PGP key or a
  [keybase](/vault/docs/concepts/pgp-gpg-keybase) username in the `-pgp-key`
  flag. The resulting token is encrypted with this public key.

An unseal key may be provided directly on the command line as an argument to the
command. If key is specified as "-", the command will read from stdin. If a TTY
is available, the command will prompt for text.


## Generate a root token with one-time password (OTP)

1. Initialize a root token generation.

   ```shell-session
   $ vault operator generate-root -init

   A One-Time-Password has been generated for you and is shown in the OTP field.
   You will need this value to decode the resulting root token, so keep it safe.
   Nonce         15565c79-cc9e-5e64-b986-8506e7bd1918
   Started       true
   Progress      0/1
   Complete      false
   OTP           5JFQaH76Ky2TIuSt4SPvO1CGkx
   OTP Length    26
   ```

   Nonce and one-time password (OTP) are generated. The nonce value should be
   distributed to all unseal key (recovery key if auto-unseal is used) holders.

   <Note title="Copy the OTP value">

   You will need the OTP value later to decode the generated root token.

   </Note>

1. Each unseal key holder provides their unseal key. If your Vault is using
   auto-unseal, enter the recovery key instead.

   ```shell-session
   $ vault operator generate-root

   Root generation operation nonce: f67f4da3-4ae4-68fb-4716-91da6b609c3e
   Unseal Key (will be hidden):
   ```

   If there is a tty, Vault will prompt for the key and automatically
   complete the nonce value. If there is no tty, or if the value is piped
   from stdin, the user must specify the nonce value from the `-init`
   operation.

   ```shell-session
   $ echo $UNSEAL_KEY | vault operator generate-root -nonce=f67f4da3... -
   ```

1. When the quorum of unseal keys (or recovery keys) are supplied, the final
   user will also get the encoded root token.

   ```shell-session
   $ vault operator generate-root

   Root generation operation nonce: f67f4da3-4ae4-68fb-4716-91da6b609c3e
   Unseal Key (will be hidden):

   Nonce            f67f4da3-4ae4-68fb-4716-91da6b609c3e
   Started          true
   Progress         5/5
   Complete         true
   Encoded Token    IxJpyqxn3YafOGhqhvP6cQ==
   ```

1. Decode the encoded token using the OTP generated during the initialization.

   ```shell-session
   $ vault operator generate-root \
     -decode=IxJpyqxn3YafOGhqhvP6cQ== \
     -otp=5JFQaH76Ky2TIuSt4SPvO1CGkx
   ```

   **Example output:**

   <CodeBlockConfig hideClipboard>

   ```plaintext
   hvs.gZcA2a9cECYY77bDviO9SEuu
   ```

   </CodeBlockConfig>

   The returned vaule (`hvs.gZcA2a9cECYY77bDviO9SEuu`) is your new root token.

## Generate a root token using PGP

1. Initialize a root token generation, providing the path to a GPG public key or
   keybase username of a user to encrypted the resulting token.

   ```shell-session
   $ vault operator generate-root -init -pgp-key=keybase:sethvargo

   Nonce              e24dec5e-f1ea-2dfe-ecce-604022006976
   Started            true
   Progress           0/5
   Complete           false
   PGP Fingerprint    e2f8e2974623ba2a0e933a59c921994f9c27e0ff
   ```

   The nonce value should be distributed to all unseal key holders.

1. Each unseal key holder providers their unseal key.

   ```shell-session
   $ vault operator generate-root

   Root generation operation nonce: e24dec5e-f1ea-2dfe-ecce-604022006976
   Unseal Key (will be hidden): ...
   ```

   If there is a tty, Vault will prompt for the key and automatically
   complete the nonce value. If there is no tty, or if the value is piped
   from stdin, the user must specify the nonce value from the `-init`
   operation.

   ```shell-session
   $ echo $UNSEAL_KEY | vault operator generate-root -nonce=f67f4da3... -
   ```

1. When the quorum of unseal keys are supplied, the final user will also get the
   encoded root token.

   ```shell-session
   $ vault operator generate-root

   Root generation operation nonce: e24dec5e-f1ea-2dfe-ecce-604022006976
   Unseal Key (will be hidden):

   Nonce                 e24dec5e-f1ea-2dfe-ecce-604022006976
   Started               true
   Progress              1/1
   Complete              true
   PGP Fingerprint       e2f8e2974623ba2a0e933a59c921994f9c27e0ff
   Encoded Token         wcFMA0RVkFtoqzRlARAAI3Ux8kdSpfgXdF9mg...
   ```

1. Decrypt the encrypted token using associated private key.

   ```shell-session
   $ echo "wcFMA0RVkFtoqzRlARAAI3Ux8kdSpfgXdF9mg..." | base64 --decode | gpg --decrypt

   d0f71e9b-ebff-6d8a-50ae-b8859f2e5671
   ```

   or via keybase:

   ```shell-session
   $ echo "wcFMA0RVkFtoqzRlARAAI3Ux8kdSpfgXdF9mg..." | base64 --decode | keybase pgp decrypt

   d0f71e9b-ebff-6d8a-50ae-b8859f2e5671
   ```

## Usage

The following flags are available in addition to the [standard set of
flags](/vault/docs/commands) included on all commands.

### Output options

- `-format` `(string: "table")` - Print the output in the given format. Valid
  formats are "table", "json", or "yaml". This can also be specified via the
  `VAULT_FORMAT` environment variable.

### Command options

- `-cancel` `(bool: false)` - Reset the root token generation progress. This
  will discard any submitted unseal keys or configuration.

- `-decode` `(string: "")` - Decode and output the generated root token. This
  option requires the `-otp` flag be set to the OTP used during initialization.
  If value is "-" then read the encoded token from stdin.

- `-generate-otp` `(bool: false)` - Generate and print a high-entropy
  one-time-password (OTP) suitable for use with the "-init" flag.

- `-init` `(bool: false)` - Start a root token generation. This can only be done
  if there is not currently one in progress.

- `-nonce` `(string; "")`- Nonce value provided at initialization. The same
  nonce value must be provided with each unseal key.

- `-otp` `(string: "")` - OTP code to use with `-decode` or `-init`.

- `-pgp-key` `(keybase or pgp)`- Path to a file on disk containing a binary or
  base64-encoded public PGP key. This can also be specified as a Keybase
  username using the format `keybase:<username>`. When supplied, the generated
  root token will be encrypted and base64-encoded with the given public key.

- `-status` `(bool: false)` - Print the status of the current attempt without
  providing an unseal key. The default is false.

- `-dr-token` `(bool: false)` - Generate DR operation token

- `-recovery-token` `(bool: false)` - Generate recovery token
